# Сервер математических моделей ИНК
Приложение позволяет производить вычисление параметров моделей с использованием клиент-серверной архитектуры.

##Минимальные системные требования
###Сервер
- ОС Ubuntu linux 18.04 / Debian 9
- python 3.6;
- СУБД PostgreSQL 12;
- nginx;
- uWSGI.

###Клиент
Любой из перечисленных web-браузеров:
- любой активно развиваемый браузер, имеющий не менее двух мажорных релизов;
- Chrome >= 60
- Firefox >= 60
- Firefox ESR
- iOS >= 12
- Safari >= 12
- IE 11

Таким образом, для мобильных устройств **поддерживаются последние версии** браузеров **Chrome, Firefox, Safari, Android browser**.
Для рабочих станций поддерживаются **последние версии** браузеров **Chrome, Firefox, Safari, Microsoft Edge, Opera**.

#Особенности
На концептуальном уровне, математические модели представляют собой совокупность алгоритмов, входных и выходных данных. 

На уровне приложения, модель `core.models.BaseMathModel` является наследником класса `django.db.models.Model` и содержит поля `user`, `input_data` и `output_data`. Последние два поля представляют собой встроенный в СУБД тип данных `jsonb`. Подобное решение хоть и противоречит каноничной реляционной теории баз данных в части нормализации, но имеет неоспоримые преимущества в гибкости. Добавление новых входных и выходных данных производится с минимальной модификацией программного кода.

За алгоримическую часть модели отвечает метод `calculate()`, который обращается к полям экземпляра класса модели, производит вычисления, записывает результат в `output_data` и возвращает вычисленные значения в вызывающий код. При вызове метода `save()` результат будет записан в СУБД. Метод `calculate()` порождает исключения `core.models.CalculationErrors` в случае ошибки во входных данных, либо при возникновении ошибки в ходе вычислений. Экземпляр исключения позволяет получить человеко-понятное пояснение при обращении к полю `e.message`. В данной демонстрационной версии приложения, для хранения входных данных и хранения промежуточных значений при вычислении используется встроенный в python тип данных `Decimal`, который обеспечивает точность до 28 знаков после запятой.

Приложение поддерживает работу с двумя видами математических моделей - синхронными, унаследованными от класса `core.models.BaseMathModel` и асинхронными, унаследованными от класса `core.models.AsyncMathModel`. Синхронные модели производят вычисления и возвращают результат пользователю в момент запроса. Асинхронные модели производят вычисления значительное время, поэтому пользователь получает уведомления о начале вычислений и об их окончании. После завершения вычислений пользователь может повторно обратиться к модели и получить результат. Таким образом, модели с малым количеством входных данных, и вычислениями продолжительностью менее 30 секунд можно отнести к синхронным, а модели, требующие работы с большим количеством данных или модели, производящие ресурсоемкие вычисления можно отнести к асинхронным. Класс `core.models.AsyncMathModel` помимо стандартных для математических моделей полей содержит так же два флага `is_ready` - флаг готовности результата, и `is_processing` - флаг выполнения вычислений в данный момент. Асинхронные модели в зависимости от значения флага `settings.DEBUG` выполняются в синхронном режиме, либо с использованием спулера uWSGI. Спулер позволяет осуществлять вычисления в отдельном процессе в порядке FIFO. Работа со спулером осуществляется в модуле `core.tasks`.

Экземпляры моделей создаются в момент обращения к ним пользователя, каждому пользователю ставится в соответствие свой экземпляр модели. Таким образом, приложение позовляет работать с математическими моделями большому количеству пользователей одновременно, каждый пользователь будет иметь свой набор входных данных и результатов.

Математические модели, доступные для пользователей, объявляются в константе `MATH_MODELS_AVAILABLE` модуля `math_model.settings`, модели можно группировать по тому или иному критерию. В данном приложении используется следующая структура для конфигурирования списка доступных моделей:
```
MATH_MODELS_AVAILABLE = {
    'Модели для скважин': [
        'core.models.WellProductionModel',
        'core.models.SimpleCalculatorModel',
        'core.models.AsyncCalculatorModel'
    ],
    'Прочие модели': [
        'core.models.SimpleCalculatorModel',
        'core.models.AsyncCalculatorModel'
    ]
}
```

Клиентская часть приложения представляет собой одностраничный тонкий клиент (SPA), реализованный средствами JS-фреймворка `Angularjs` и `Angular-UI Router`. За дизайн и структуру элементов пользовательского интерфейса отвечает CSS-фреймворк `Bootstrap v5.0`. Взаимодействие с серверной частью выполняется посредством REST-API.

Приложение позволяет осуществлять разграничение прав доступа. Данная демонстрационная версия ограничивает возможность работы с приложением не аутентифициорованных пользователей. Ограничивается доступ как к web-интерфейсу, так и к REST-API. Возможно ограничение доступа пользователей к конкретным математическим моделям.